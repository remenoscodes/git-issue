#!/bin/sh
#
# git-issue-export - Export local issues to an external provider
#

set -e

usage() {
	cat <<EOF
usage: git issue export <provider> [options]

Supported providers:
   github:<owner>/<repo>        GitHub repository
   gitlab:<group>/<project>     GitLab project
   gitea:<owner>/<repo>         Gitea repository
   forgejo:<owner>/<repo>       Forgejo repository

Options vary by provider. Use 'git issue export <provider> --help' for provider-specific options.

Common options:
   --dry-run         Show what would be exported without exporting
   -h, --help        Show this help
EOF
	exit 1
}

# Check for help flag before parsing
for arg in "$@"
do
	case "$arg" in
		-h|--help)
			usage
			;;
	esac
done

# Extract provider (first non-option argument)
provider=""
for arg in "$@"
do
	case "$arg" in
		-*) ;;  # Skip options
		*)
			if test -z "$provider"
			then
				provider="$arg"
				break
			fi
			;;
	esac
done

if test -z "$provider"
then
	echo "error: provider is required (e.g., github:owner/repo)" >&2
	usage
fi

# Find the directory containing the git-issue scripts
ISSUE_BIN_DIR="$(cd "$(dirname "$0")" && pwd)"

# Delegate to provider-specific script, passing ALL arguments
case "$provider" in
	github:*/*)
		exec "$ISSUE_BIN_DIR/git-issue-export-github" "$@"
		;;
	gitlab:*/*)
		exec "$ISSUE_BIN_DIR/git-issue-export-gitlab" "$@"
		;;
	gitea:*/*)
		exec "$ISSUE_BIN_DIR/git-issue-export-gitea" "$@"
		;;
	forgejo:*/*)
		exec "$ISSUE_BIN_DIR/git-issue-export-gitea" "$@"
		;;
	*)
		echo "error: unsupported or invalid provider '$provider'" >&2
		echo "       supported: github:<owner>/<repo>, gitlab:<owner>/<project>, gitea:<owner>/<repo>, forgejo:<owner>/<repo>" >&2
		exit 1
		;;
esac
